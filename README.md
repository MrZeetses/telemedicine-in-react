# TeleMed — Модуль телемедицины

## Структура файлов

| Файл | Описание |
|------|----------|
| `supabase_schema.sql` | SQL-схема для базы данных Supabase |
| `TeleMed.jsx` | React-приложение (кабинет администратора) |

---

## Шаг 1 — Настройка Supabase

### 1.1 Создайте проект
Перейдите на [supabase.com](https://supabase.com) → New Project.

### 1.2 Выполните SQL-схему
Перейдите в **SQL Editor** и выполните содержимое файла `supabase_schema.sql`.

Это создаст:
- Таблицу `consultations` со всеми полями
- Row Level Security (только авторизованные пользователи)
- Триггер обновления `updated_at`
- Индексы для быстрого поиска
- View `consultations_view` для удобных запросов

### 1.3 Включите Realtime
**Database → Replication → supabase_realtime** → добавьте таблицу `consultations`.

### 1.4 Создайте аккаунт администратора
**Authentication → Users → Invite** → введите email администратора.  
Администратор получит письмо и задаст пароль.

---

## Шаг 2 — Настройка приложения

Откройте `TeleMed.jsx` и замените в начале файла:

```js
const SUPABASE_URL = "https://YOUR_PROJECT.supabase.co";
const SUPABASE_ANON_KEY = "YOUR_ANON_KEY";
```

Ваши значения находятся в **Settings → API** вашего Supabase проекта.

---

## Шаг 3 — Запуск

### Вариант A — Vite (рекомендуется)

```bash
npm create vite@latest telemed -- --template react
cd telemed
npm install @supabase/supabase-js
# Скопируйте TeleMed.jsx как src/App.jsx
npm run dev
```

### Вариант B — Stackblitz / CodeSandbox
Создайте React-проект и вставьте содержимое `TeleMed.jsx` как `App.jsx`,  
добавьте зависимость `@supabase/supabase-js`.

---

## Функциональность

### Авторизация
- Вход по email/паролю через Supabase Auth
- Сброс пароля через email

### Кабинет администратора
- ✅ Создание консультации (ФИО врача/пациента, телефоны, дата, время)
- ✅ Автодополнение ФИО врача из истории
- ✅ Генерация уникальных ссылок для врача и пациента
- ✅ Копирование ссылок в буфер
- ✅ Список консультаций с поиском по ФИО
- ✅ Фильтрация по дате и статусу
- ✅ Отображение завершённых под кнопкой
- ✅ Детальная панель справа при клике на консультацию
- ✅ Изменение даты и времени консультации
- ✅ Подтверждённое удаление (только до начала приёма)
- ✅ Подтверждённая отмена консультации
- ✅ Обработка запросов на отмену от пациента
- ✅ Realtime-обновления через Supabase Realtime

### Статусы консультаций
| Статус | Описание |
|--------|----------|
| `scheduled` | Запланирована |
| `cancel_requested` | Пациент запросил отмену/перенос |
| `cancelled` | Отменена |
| `completed` | Завершена (автоматически через 3 ч) |

---

## Структура таблицы `consultations`

| Поле | Тип | Описание |
|------|-----|----------|
| `id` | UUID | Первичный ключ |
| `doctor_name` | TEXT | ФИО врача |
| `patient_name` | TEXT | ФИО пациента |
| `doctor_phone` | TEXT | Телефон врача |
| `patient_phone` | TEXT | Телефон пациента |
| `scheduled_at` | TIMESTAMPTZ | Дата и время приёма |
| `doctor_link` | TEXT | Ссылка для врача |
| `patient_link` | TEXT | Ссылка для пациента |
| `status` | TEXT | Статус консультации |
| `created_at` | TIMESTAMPTZ | Дата создания |
| `updated_at` | TIMESTAMPTZ | Дата обновления |

---

## Следующие шаги (расширение)

- **SMS-уведомления**: Подключите Twilio или SMS.ru через Supabase Edge Functions
- **Видеозвонки**: Интегрируйте WebRTC (Daily.co, Agora, Twilio Video)
- **Онлайн-оплата**: Подключите Альфа-банк эквайринг
- **Страница пациента/врача**: Отдельные роуты с таймером обратного отсчёта
